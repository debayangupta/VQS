<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <title>VisPanels</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="mainstyles.css">
    <link rel="stylesheet" href="styles/css/redmond/jquery-ui-1.8.11.custom.css">
    <script type="text/javascript" src="styles/js/jquery-1.5.1.min.js"></script>
    <script type="text/javascript" src="styles/js/jquery-ui-1.8.11.custom.min.js"></script>
    <script type="text/javascript" src="datatable/jquery.dataTables.js"></script>
    <script type="text/javascript">
        $(function() {
        
        var dimension = 1;
        
        function refreshVisList(dimension){
            if(dimension == 1){
                $("#vislist").empty();
                $('<li id="barchart" class="vislistitem"><a href="#"><img src="Images/barchart-icon.png"></a>Bar Chart</li>').appendTo('#vislist');
                $('<li id="histogram" class="vislistitem"><a href="#"><img src="Images/histogram-icon.png"></a>Histogram</li>').appendTo('#vislist');
            }
            else if(dimension == 2){
                $("#vislist").empty();
                $('<li id="areachart" class="vislistitem"><a href="#"><img src="Images/area-icon.png"></a>Area Chart</li>').appendTo('#vislist');
                $('<li id="scatterplot" class="vislistitem"><a href="#"><img src="Images/scatterplot-icon.png"></a>Scatter Plot</li>').appendTo('#vislist');
                $('<li id="boxplot" class="vislistitem"><a href="#"><img src="Images/boxplot-icon.png"></a>Box Plot</li>').appendTo('#vislist');
            }
            else if(dimension == 3){
                $("#vislist").empty();
                $('<li id="scatterplot" class="vislistitem"><a href="#"><img src="Images/scatterplot-icon.png"></a>Scatter Plot</li>').appendTo('#vislist');
            }
            $(".vislistitem").bind('click', function(){
                alert($(this).attr("id"));
                alert($("#input-x").val());
                alert($("#input-y").val());
                alert($("#input-z").val());
                var index = $.inArray($("#input-x").val().trim(), availableTags);
                alert(index);
                if(index > -1){
                    fnShow(index);
                }
                var index = $.inArray($("#input-y").val().trim(), availableTags);
                alert(index);
                if(index > -1){
                    fnShow(index);
                }
                var index = $.inArray($("#input-y").val().trim(), availableTags);
                alert(index);
                if(index > -1){
                    fnShow(index);
                }
            });
        }
        
        refreshVisList(dimension);
        
        $("#remove-source").button({text: false, icons: {primary: "ui-icon-minus"}, disabled: true});
        $("#add-source").button({text: false, icons: {primary: "ui-icon-plus"}, disabled: false});
        $("#reset-source").button({text: false, icons: {primary: "ui-icon-refresh"}, disabled: false});
        $( "#add-source" )
			.button()
			.click(function() {
                    if(dimension == 1){
                    $("#y").css({'visibility': 'visible'});
                    dimension = 2;
                    $("#remove-source").button({disabled: false});
                }
                else if(dimension == 2){
                    $("#z").css({'visibility': 'visible'});
                    dimension = 3;
                    $(this).button({disabled: true});
                }
                else {
                
                }
                refreshVisList(dimension);
        });
        $( "#remove-source" )
			.button()
			.click(function() {
                if(dimension == 3){
                    $("#input-z").val("");
                    $("#z").css({'visibility': 'hidden'});
                    dimension = 2;
                    $("#add-source").button({disabled: false});
                }
                else if(dimension == 2){
                    $("#input-y").val("");
                    $("#y").css({'visibility': 'hidden'});
                    dimension = 1;
                    $(this).button({disabled: true});             
                }
                else {
                
                }
                refreshVisList(dimension);
            });
        $( "#reset-source" )
			.button()
			.click(function() {
                if(dimension == 3){
                    $("#input-z").val("");
                    $("#z").css({'visibility': 'hidden'});
                    dimension = 2;
                    $("#add-source").button({disabled: false});
                }
                if(dimension == 2){
                    $("#input-y").val("");
                    $("#y").css({'visibility': 'hidden'});
                    dimension = 1;
                    $("#remove-source").button({disabled: true});             
                }
                $("#input-x").val("");
                refreshVisList(dimension);
            });
            
        
		var availableTags = []; 
        $.getJSON("relations.js", function(json) {
            availableTags = json.abbrv;
            /* Insert all values into table before creating datatable */
            for (var i = 0; i < availableTags.length; i++){
                $("#datatable>thead>tr").append("<th>" + availableTags[i] + "</th>");
            }
            $('#datatable').dataTable({"bSort": false, "bAutoWidth": false, "bJQueryUI": true, "bPaginate": false});
            for(var i = 0; i < availableTags.length; i++){
                fnHide(i);
            }
        });
        
        function fnHide( iCol ){
            var oTable = $('#datatable').dataTable();
            var bVis = oTable.fnSettings().aoColumns[iCol].bVisible;
            oTable.fnSetColumnVis( iCol, false );
        }
        
        function fnShow( iCol ){
            var oTable = $('#datatable').dataTable();
            var bVis = oTable.fnSettings().aoColumns[iCol].bVisible;
            alert("Set visible");
            oTable.fnSetColumnVis( iCol, true );
        }
        
        
        function split( val ) {
			return val.split( /\s+/ );
		}
		function extractLast( term ) {
			return split( term ).pop();
		}

		$( ".fields" )
			// don't navigate away from the field on tab when selecting an item
			.bind( "keydown", function( event ) {
				if ( event.keyCode === $.ui.keyCode.TAB &&
						$( this ).data( "autocomplete" ).menu.active ) {
					event.preventDefault();
				}
			})
			.autocomplete({
				minLength: 0,
				source: function( request, response ) {
					// delegate back to autocomplete, but extract the last term
					response( $.ui.autocomplete.filter(
						availableTags, extractLast( request.term ) ) );
				},
				focus: function() {
					// prevent value inserted on focus
					return false;
				},
				select: function( event, ui ) {
					var terms = split( this.value );
					// remove the current input
					terms.pop();
					// add the selected item
					terms.push( ui.item.value );
					// add placeholder to get the comma-and-space at the end
					terms.push( "" );
					this.value = terms.join( " " );
					return false;
				}
			});
	});
    </script>
</head>
<body>
    <div id="main-header">
        <img id="logo" src="Images/logo.png">
        <div id="project-title"><span id="project-name">emdata</span></div>
        <div id="project-controls">
            <a href="#" class="project-control-buttons ui-state-default ui-corner-all"><span class="ui-icon ui-icon-star"></span>Export</a>
            <a href="#" class="project-control-buttons ui-state-default ui-corner-all"><span class="ui-icon ui-icon-help"></span>Help</a>
        </div></div>
    <div id="left-panel" class="ui-widget">
        <div id="dspanel" class="ui-widget-content ui-corner-all">
            <h3 class="ui-widget-header">Data Control</h3>
            <div id="ds-control-panel">
                <ul class="control-buttons">
                    <li> <button id="add-source">Add Source</button> </li>
                    <li> <button id="remove-source">Remove Source</button> </li>
                    <li> <button id="reset-source">Reset Source</button> </li>
                    <ul>
                    </ul>
                </ul></div>
            <div id="dssubpanel">
                <ul class="datasources">
                    <li id="x" class="datasource">
                        <div class="exp ui-widget">
                            <input id="input-x" class="fields">
                        </div>
                    </li>
                    <li id="y" class="datasource">
                        <div class="exp ui-widget">
                            <input id="input-y" class="fields">
                        </div>
                    </li>
                    <li id="z" class="datasource">
                        <div class="exp ui-widget">
                            <input id="input-z" class="fields">
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div id="visualizations" class="ui-widget-content ui-corner-all">
            <h3 class="ui-widget-header">Visualizations</h3>
            <ul id="vislist">
            </ul>
        </div>
    </div>
    <div id="right-panel">
        <div id="vispanel" class="ui-widget-content ui-corner-all">
        </div>
        <div id="tablepanel" class="ui-widget-content ui-corner-all">
            <table id="datatable">
                <thead>
                    <tr>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
